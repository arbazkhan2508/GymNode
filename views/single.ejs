<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="../stylesheets/nav.css">
    <link rel="stylesheet" href="../stylesheets/footer.css">
    <link rel="stylesheet" href="../stylesheets/cartss.css">
    <link rel="stylesheet" href="../stylesheets/search.css">
    <link rel="stylesheet" href="../stylesheets/singleprodecu.css">
</head>

<body>
    <% include ./partials/nav.ejs %>
    <% include ./partials/search.ejs %>

    <% if(user){ %>
        <% include ./partials/cart.ejs %>
    <% } %>

       <div class="cart_wrappers">
        <div id="carts">
            <div id="cart_top">
                 <h3>Cart <span><%= user.carts.length %></span></h3>
                 <i id="closecart" class="ri-close-fill"></i>
            </div>
            <div class="carttt">
                <div class="cart_toppp">
                    <% var sum = 0 %>
                   <% user.carts.forEach(function(cart){ %>
                       <div class="cart">
                           <div class="lcart">
                               <div class="cimg">
                                   <img src="../images/uploads/productimages/<%= cart.productId.pic[3] %>" alt="">
                              </div>
                              <div class="ctxt">
                                  <h6><%= cart.productId.productName %></h6>
                                  <small>RS.<%= cart.productId.Price %>.00</small>
                                  <% sum+=  cart.productId.Price %>
                              </div>
                           </div>
                           <div class="rcart">
                                 <div class="quant">
                                      <h6><%= cart.quantity %></h6>
                                 </div>
                                 <p onclick="window.location.href='/remove/cart/<%= cart._id %>'" id="p">Remove</p>
                           </div>
                             
                        </div>
                        
                  <% }) %>
                </div>
            </div>
            <div class="pric_e">
                <div class="amt">
                    <div class="aml">
                        <h4>Total</h4>
                        <p>Taxes and &nbsp;
                        <span>shipping</span>&nbsp; calculated at checkout</p>
                    </div>
                    <h1>Rs.&nbsp;<%= sum %>.00</h1>
                </div>
                <div class="cartbtns">
                       <div class="vc">
                           View cart
                       </div>
                       <div class="vc">
                           <svg role="presentation" fill="none" focusable="false" stroke-width="2" width="18" height="18" class="icon icon-picto-lock" viewBox="0 0 24 24">
                               <path d="M3.236 18.182a5.071 5.071 0 0 0 4.831 4.465 114.098 114.098 0 0 0 7.865-.001 5.07 5.07 0 0 0 4.831-4.464 23.03 23.03 0 0 0 .165-2.611c0-.881-.067-1.752-.165-2.61a5.07 5.07 0 0 0-4.83-4.465c-1.311-.046-2.622-.07-3.933-.069a109.9 109.9 0 0 0-3.933.069 5.07 5.07 0 0 0-4.83 4.466 23.158 23.158 0 0 0-.165 2.609c0 .883.067 1.754.164 2.61Z" fill="currentColor" fill-opacity=".12" stroke="currentColor"></path>
                               <path d="M17 8.43V6.285A5 5 0 0 0 7 6.286V8.43" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
                               <path d="M12 17.714a2.143 2.143 0 1 0 0-4.286 2.143 2.143 0 0 0 0 4.286Z" stroke="currentColor"></path>
                             </svg>
                           Checkout
                       </div>
                </div>
            </div>
          </div>
       </div>
        <div id="main">
            <div id="pg1">
                <div id="pg1img">
                    <div class="single_img">
                        <img src="../images/uploads/productimages/<%= product.pic[4] %>" alt="">
                    </div>
                </div>
                <div id="pg1text">
                    <div class="pricing">
                        <h1><%= product.productName %></h1>
                        <div class="price">
                            <h6>Rs. 6,600.00</h6>
                            <div class="small">
                                <small>Rs. 10,800.00</small>
                                <div class="sline"></div>
                            </div>
                            <p>Save 39%</p>
                        </div>
                        <div class="icons">
                            <i class="ri-star-fill"></i><i class="ri-star-fill"></i><i class="ri-star-fill"></i><i
                                class="ri-star-fill"></i><i class="ri-star-fill"></i>
                        </div>
                        <div class="counters">
                            <h4>Quantity:</h4>
                            <div class="cntr">
                                <i onclick="decrementCount()" class="ri-subtract-line"></i>
                                <small id="countSpan">
                                    <%= count %>
                                </small>
                                <i onclick="incrementCount()" class="ri-add-line"></i>
                            </div>
                        </div>
                        <div onclick="sendToCart()" class="cart">
                            Add to cart
                        </div>
                        <h3>In Stock with Next Day Shipping!</h3>
                    </div>
                    <h6 id="et">Elevate Your Training TodayðŸ‘‡</h6>
                    <div class="suggest">
                        <% randomSubset.forEach(function(sug){ %>
                            <div class="sugg">
                                <div class="sugl">
                                    <div class="sugimg">
                                        <img src="../images/uploads/productimages/<%= sug.pic[1] %>"
                                            alt="">
                                    </div>
                                    <div class="sugtxt">
                                        <h6><%= sug.productName %></h6>
                                        <p>Rs. <%= sug.Price %>.00</p>
                                    </div>


                                </div>
                                <div class="add">
                                    <i class="ri-add-fill"></i>
                                    Add
                                </div>
                            </div>
                            <% }) %>
                                
                    </div>
                    <div class="des">
                        <small id="repl">
                            <%= product.Des %>
                        </small>
                        <p style="font-weight: 600;font-size: 1.3vmax;font-family: roobert;margin-top: 2vmax;">
                            <%= product.bolt %>
                        </p>
                    </div>
                    <div class="optrows">
                        <div id="roww1" class="orows">
                            <div class="ortop">
                                <h6>Gear Space</h6>
                                <i class="ri-arrow-down-s-line"></i>
                            </div>
                            <div class="p">
                                <div class="dot"></div>
                                <p>Weight&nbsp &nbsp: <%= product.weight %>lbs</p>
                            </div>
                            <div class="p">
                                <div class="dot"></div>
                                <p>Height&nbsp &nbsp: <%= product.height %><sup>"</sup></p>

                            </div>
                            <div class="p">

                                <div class="dot"></div>
                                <p>Length &nbsp &nbsp:Premium Weight Clamp</p>
                            </div>
                            <div class="p">
                                <div class="dot"></div>
                                <p>Width&nbsp &nbsp :Heavy-Duty Steel Construction</p>
                            </div>
                            <div class="p">
                                <div class="dot"></div>
                                <p>Width&nbsp &nbsp :Long Lasting Premium Foam></p>
                            </div>
                            <div class="p">
                                <div class="dot"></div>
                                <p>Width&nbsp &nbsp :Removable Loading Bar</p>
                            </div>

                        </div>
                        <div id="roww2" style="border-top: none;" class="orows">
                            <div class="ortop">
                                <h6>Shipping</h6>
                                <i class="ri-arrow-down-s-line"></i>
                            </div>
                            <p>All products, excluding pre-order items, ship the next day, except for orders received on
                                Saturday after 12pm EST or otherwise stated on the product listing. Orders received on
                                Saturday after 12pm EST and Sunday will be processed on the next business day.</p>
                            <p style="margin-top: 1vmax;">Shipping for the contiguous United States takes between 2-5
                                business days and is shipped through USPSÂ®, UPS GroundÂ®, or FedExÂ®.</p>
                            <p style="margin-top: 1vmax;">Delivery details will be provided via email, which is sent
                                after your order has been processed.</p>
                            <p style="margin-top: 1vmax;">Use The Tib Bar Guy Shipping Center to track your order!</p>
                        </div>
                    </div>

                </div>
            </div>
            <div id="imagesss">
                <div class="rimgsss">
                    <img src="../images/uploads/productimages/<%= product.pic[1] %>" alt="">
                </div>
                <div class="rimgsss">
                    <div class="r11m">
                        <img src="../images/uploads/productimages/<%= product.pic[2] %>" alt="">
                    </div>
                    <div class="r11m">
                        <img src="../images/uploads/productimages/<%= product.pic[4] %>" alt="">

                    </div>
                </div>
                <div class="rimgsss">
                    <img src="../images/uploads/productimages/<%= product.pic[3] %>" alt="">
                </div>
            </div>
            <h1>FREQUENTLY BOUGHT <br> TOGETHER</h1>
            <div id="products_wrapper">
                <div id="products">
                    <% randomSubset.forEach(function(prd){ %>
                        <div onclick="window.location.href='/single/<%= product._id %>'" id="product">
                            <div class="img">
                                <img src="../images/uploads/productimages/<%= prd.pic[0] %>"
                                    alt="">
                                <div class="overlay">
                                <img src="../images/uploads/productimages/<%= prd.pic[1] %>"
                                        alt="">
                                    <div class="add">
                                        <i class="ri-add-fill"></i>
                                        <small>Quick add</small>
                                    </div>
                                </div>
                            </div>
                            <div class="text">
                                <h4>TiB BAR PRO</h4>
                                <!-- <h4><%= product.productName %></h4> -->
                                <div class="stars">
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                    <i class="ri-star-fill"></i>
                                </div>
                                <h6>Rs.5332.00</h6>
                            </div>
                        </div>
                        <% }) %>
                        
                          
                       
                </div>
            </div>
            <% include ./partials/footer.ejs %>

        </div>

        <% include ./partials/loco.ejs %>
               
                <script src="../javascripts/listner.js"></script>
                <script src="../javascripts/search.js"></script>
                <script src="../javascripts/nav.js"></script>
            <script>
                function splitContentIntoChunks() {
                    const smallTag = document.getElementById("repl");
                    const content = smallTag.textContent;
                    const words = content.split(/\s+/);

                    let chunks = [];
                    while (words.length > 0) {
                        const chunk = words.splice(0, 100).join(" ");
                        chunks.push(chunk);
                    }

                    //   const modifiedContent = chunks.join("<br>");
                    const modifiedContent = chunks.map(chunk => `<div class="chunk">${chunk}</div>`).join("<br>");

                    smallTag.innerHTML = modifiedContent;
                }

                // Call the function when the page loads
                splitContentIntoChunks();

                // let count = <%= count %>;

                function incrementCount() {
                    let c = document.querySelector("#countSpan").textContent;
                    c++;
                    //   c.innerHTML = c;
                    document.getElementById('countSpan').textContent = c;
                    console.log(c, "uts c");

                }

                function decrementCount() {

                    let c = document.querySelector("#countSpan").textContent;
                    if (c > 0) {
                        c--;
                        document.getElementById('countSpan').textContent = c;

                    }
                    //   c.innerHTML = c;

                }

                function sendToCart() {
                    // Get the variableData from the EJS template
                    const variableData = document.getElementById('countSpan').textContent;

                    // Make an AJAX request to the server (using Fetch API)
                    fetch('/cart/<%= product._id %>', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ data: variableData }),
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Server response:', data);
                            // You can handle the server response here as needed
                            // For example, display a message indicating success, etc.
                        })
                        .catch(error => {
                            console.error('Error sending data:', error);
                        });
                }


            </script>
</body>

</html>